/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, TemplateRef } from "@angular/core";
import isEqual from "lodash.isequal";
/**
 * @record
 */
export function SelectedItemInterface() { }
if (false) {
    /** @type {?} */
    SelectedItemInterface.prototype.item;
    /** @type {?} */
    SelectedItemInterface.prototype.index;
    /** @type {?} */
    SelectedItemInterface.prototype.first;
}
/*
 *
 * @param() items - List of items to belong in carousel
 * @param() width - Size of window(view) to show
 * @param() $prev - Template for previous button
 * @param() $next - Template for next button
 * @param() $item - Template for the item
 */
export class Ng2CarouselamosComponent {
    constructor() {
        this.items = [];
        this.width = 500;
        this.onSelectedItem = new EventEmitter();
        this.childIndex = 0;
        this.amount = 0;
        this.startPress = 0;
        this.lastX = 0;
    }
    /**
     * @param {?} e
     * @return {?}
     */
    onMousedown(e) {
        if (e.which === 1) {
            this.startPress = e.clientX;
            this.lastX = this.amount;
        }
    }
    /**
     * @param {?} e
     * @return {?}
     */
    onTouchdown(e) {
        if (navigator.userAgent.indexOf("Android") >= 0)
            e.preventDefault();
        this.startPress = e.targetTouches[0].clientX;
        this.lastX = this.amount;
    }
    /**
     * @param {?} e
     * @param {?} maxWidth
     * @return {?}
     */
    onMousemove(e, maxWidth) {
        if (e.which === 1) {
            /** @type {?} */
            const amount = this.lastX - (this.startPress - e.clientX);
            if (amount > 0 || amount < -(maxWidth - this.width))
                return;
            this.amount = amount;
        }
    }
    /**
     * @param {?} e
     * @param {?} maxWidth
     * @return {?}
     */
    onTouchmove(e, maxWidth) {
        if (navigator.userAgent.indexOf("Android") >= 0)
            e.preventDefault();
        /** @type {?} */
        const amount = this.lastX - (this.startPress - e.targetTouches[0].clientX);
        if (amount > 0 || amount < -(maxWidth - this.width))
            return;
        this.amount = amount;
    }
    /**
     * @param {?} e
     * @param {?} elem
     * @return {?}
     */
    onMouseup(e, elem) {
        if (e.which === 1) {
            this.startPress = 0;
            this.snap(elem);
        }
    }
    /**
     * @param {?} e
     * @param {?} elem
     * @return {?}
     */
    onTouchup(e, elem) {
        if (navigator.userAgent.indexOf("Android") >= 0)
            e.preventDefault();
        this.startPress = 0;
        this.snap(elem);
    }
    /**
     * @param {?} elem
     * @return {?}
     */
    snap(elem) {
        /** @type {?} */
        let counter = 0;
        /** @type {?} */
        let lastVal = 0;
        for (let i = 0; i < this.items.length; i++) {
            /** @type {?} */
            const el = elem.children[i];
            /** @type {?} */
            const style = el.currentStyle || window.getComputedStyle(el);
            counter +=
                el.offsetWidth +
                    (parseFloat(style.marginLeft) + parseFloat(style.marginRight));
            if (this.amount <= lastVal && this.amount >= -counter) {
                this.amount = -lastVal;
                this.childIndex = i;
                this.onSelectedItem.emit({
                    item: this.items[this.childIndex],
                    index: this.childIndex,
                    first: false
                });
                return;
            }
            lastVal = counter;
        }
        return counter;
    }
    /**
     * @param {?} forward
     * @param {?} elem
     * @return {?}
     */
    scroll(forward, elem) {
        this.childIndex += forward ? 1 : -1;
        this.onSelectedItem.emit({
            item: this.items[this.childIndex],
            index: this.childIndex,
            first: false
        });
        this.amount = -this.calcScroll(elem);
    }
    /**
     * @param {?} elem
     * @return {?}
     */
    calcScroll(elem) {
        /** @type {?} */
        let counter = 0;
        for (let i = this.childIndex - 1; i >= 0; i--) {
            /** @type {?} */
            const el = elem.children[i];
            /** @type {?} */
            const style = el.currentStyle || window.getComputedStyle(el);
            counter +=
                el.offsetWidth +
                    (parseFloat(style.marginLeft) + parseFloat(style.marginRight));
        }
        return counter;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.items &&
            !isEqual(changes.items.previousValue, changes.items.currentValue)) {
            if (changes.items.firstChange) {
                this.onSelectedItem.emit({
                    item: this.items[this.childIndex],
                    index: this.childIndex,
                    first: true
                });
            }
            this.amount = 0;
        }
    }
}
Ng2CarouselamosComponent.decorators = [
    { type: Component, args: [{
                selector: "[ng2-carouselamos]",
                template: "<div class=\"ng2-carouselamos-container\">\n  <div\n    class=\"ng2-carouselamos-wrapper\"\n    [style.width]=\"width + 'px'\"\n    (mousedown)=\"onMousedown($event)\"\n    (touchstart)=\"onTouchdown($event)\"\n    (mousemove)=\"onMousemove($event, list.scrollWidth)\"\n    (touchmove)=\"onTouchmove($event, list.scrollWidth)\"\n    (mouseup)=\"onMouseup($event, list)\"\n    (mouseleave)=\"onMouseup($event, list)\"\n    (touchend)=\"onTouchup($event, list)\"\n  >\n    <div\n      class=\"ng2-carouselamos\"\n      [attr.startPress]=\"startPress\"\n      [style.transition]=\"startPress > 0 ? 'none' : '-webkit-transform 1s'\"\n      [style.webkitTransition]=\"\n        startPress > 0 ? 'none' : '-webkit-transform 1s'\n      \"\n      [style.transform]=\"'translateX(' + amount + 'px)'\"\n      [style.webkitTransform]=\"'translateX(' + amount + 'px)'\"\n      #list\n    >\n      <ng-template\n        *ngFor=\"let item of items; let i = index\"\n        [ngTemplateOutlet]=\"$item\"\n        [ngTemplateOutletContext]=\"{\n          $implicit: item,\n          index: i,\n          selectedIndex: childIndex\n        }\"\n      ></ng-template>\n    </div>\n  </div>\n  <div class=\"controls\" *ngIf=\"$prev || $next\">\n    <button\n      type=\"button\"\n      *ngIf=\"$prev\"\n      (click)=\"scroll(false, list)\"\n      [disabled]=\"amount >= 0\"\n    >\n      <ng-template [ngTemplateOutlet]=\"$prev\"></ng-template>\n    </button>\n    <button\n      type=\"button\"\n      *ngIf=\"$next\"\n      (click)=\"scroll(true, list)\"\n      [disabled]=\"amount <= -(list.scrollWidth - width)\"\n    >\n      <ng-template [ngTemplateOutlet]=\"$next\"></ng-template>\n    </button>\n  </div>\n</div>\n",
                styles: [".ng2-carouselamos-container{position:relative;display:flex;justify-content:center}.ng2-carouselamos-wrapper{overflow:hidden}.ng2-carouselamos{display:flex;transition:transform 1s}.controls{pointer-events:none;position:absolute;display:flex;width:100%;justify-content:space-between;top:50%;left:0;transform:translateY(-50%)}.controls button{pointer-events:all;background:0 0;border:0}"]
            }] }
];
Ng2CarouselamosComponent.propDecorators = {
    items: [{ type: Input }],
    width: [{ type: Input }],
    $prev: [{ type: Input }],
    $next: [{ type: Input }],
    $item: [{ type: Input }],
    onSelectedItem: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.items;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.width;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.$prev;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.$next;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.$item;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.onSelectedItem;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.childIndex;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.amount;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.startPress;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.lastX;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmcyLWNhcm91c2VsYW1vcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZzItY2Fyb3VzZWxhbW9zLyIsInNvdXJjZXMiOlsibGliL25nMi1jYXJvdXNlbGFtb3MuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFdBQVcsRUFFWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLE9BQU8sTUFBTSxnQkFBZ0IsQ0FBQzs7OztBQUVyQywyQ0FJQzs7O0lBSEMscUNBQVU7O0lBQ1Ysc0NBQWM7O0lBQ2Qsc0NBQWU7O0FBUWpCOzs7Ozs7O0dBT0c7QUFDSCxNQUFNLE9BQU8sd0JBQXdCO0lBYnJDO1FBY1csVUFBSyxHQUFlLEVBQUUsQ0FBQztRQUN2QixVQUFLLEdBQVcsR0FBRyxDQUFDO1FBSW5CLG1CQUFjLEdBRXBCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDdkIsZUFBVSxHQUFXLENBQUMsQ0FBQztRQUN2QixXQUFNLEdBQVcsQ0FBQyxDQUFDO1FBQ25CLGVBQVUsR0FBVyxDQUFDLENBQUM7UUFDdkIsVUFBSyxHQUFXLENBQUMsQ0FBQztJQXNHcEIsQ0FBQzs7Ozs7SUFwR0MsV0FBVyxDQUFDLENBQWE7UUFDdkIsSUFBSSxDQUFDLENBQUMsS0FBSyxLQUFLLENBQUMsRUFBRTtZQUNqQixJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDNUIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1NBQzFCO0lBQ0gsQ0FBQzs7Ozs7SUFDRCxXQUFXLENBQUMsQ0FBYTtRQUN2QixJQUFJLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUM7WUFBRSxDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDcEUsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFD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Q0FBQzs7Ozs7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFDRSxPQUFPLENBQUMsS0FBSztZQUNiLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLEVBQ2pFO1lBQ0EsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRTtnQkFDN0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUM7b0JBQ3ZCLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7b0JBQ2pDLEtBQUssRUFBRSxJQUFJLENBQUMsVUFBVTtvQkFDdEIsS0FBSyxFQUFFLElBQUk7aUJBQ1osQ0FBQyxDQUFDO2FBQ0o7WUFDRCxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztTQUNqQjtJQUNILENBQUM7OztZQTlIRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLG9CQUFvQjtnQkFFOUIscXJEQUFnRDs7YUFDakQ7OztvQkFVRSxLQUFLO29CQUNMLEtBQUs7b0JBQ0wsS0FBSztvQkFDTCxLQUFLO29CQUNMLEtBQUs7NkJBQ0wsTUFBTTs7OztJQUxQLHlDQUFnQzs7SUFDaEMseUNBQTZCOztJQUM3Qix5Q0FBaUM7O0lBQ2pDLHlDQUFpQzs7SUFDakMseUNBQWlDOztJQUNqQyxrREFFdUI7O0lBQ3ZCLDhDQUF1Qjs7SUFDdkIsMENBQW1COztJQUNuQiw4Q0FBdUI7O0lBQ3ZCLHlDQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBUZW1wbGF0ZVJlZixcbiAgU2ltcGxlQ2hhbmdlc1xufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IGlzRXF1YWwgZnJvbSBcImxvZGFzaC5pc2VxdWFsXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VsZWN0ZWRJdGVtSW50ZXJmYWNlIHtcbiAgaXRlbTogYW55O1xuICBpbmRleDogbnVtYmVyO1xuICBmaXJzdDogYm9vbGVhbjtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcIltuZzItY2Fyb3VzZWxhbW9zXVwiLFxuICBzdHlsZVVybHM6IFtcIi4vbmcyLWNhcm91c2VsYW1vcy5jb21wb25lbnQuc2Nzc1wiXSxcbiAgdGVtcGxhdGVVcmw6IFwiLi9uZzItY2Fyb3VzZWxhbW9zLmNvbXBvbmVudC5odG1sXCJcbn0pXG4vKlxuICpcbiAqIEBwYXJhbSgpIGl0ZW1zIC0gTGlzdCBvZiBpdGVtcyB0byBiZWxvbmcgaW4gY2Fyb3VzZWxcbiAqIEBwYXJhbSgpIHdpZHRoIC0gU2l6ZSBvZiB3aW5kb3codmlldykgdG8gc2hvd1xuICogQHBhcmFtKCkgJHByZXYgLSBUZW1wbGF0ZSBmb3IgcHJldmlvdXMgYnV0dG9uXG4gKiBAcGFyYW0oKSAkbmV4dCAtIFRlbXBsYXRlIGZvciBuZXh0IGJ1dHRvblxuICogQHBhcmFtKCkgJGl0ZW0gLSBUZW1wbGF0ZSBmb3IgdGhlIGl0ZW1cbiAqL1xuZXhwb3J0IGNsYXNzIE5nMkNhcm91c2VsYW1vc0NvbXBvbmVudCB7XG4gIEBJbnB1dCgpIGl0ZW1zOiBBcnJheTxhbnk+ID0gW107XG4gIEBJbnB1dCgpIHdpZHRoOiBudW1iZXIgPSA1MDA7XG4gIEBJbnB1dCgpICRwcmV2OiBUZW1wbGF0ZVJlZjxhbnk+O1xuICBASW5wdXQoKSAkbmV4dDogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgJGl0ZW06IFRlbXBsYXRlUmVmPGFueT47XG4gIEBPdXRwdXQoKSBvblNlbGVjdGVkSXRlbTogRXZlbnRFbWl0dGVyPFxuICAgIFNlbGVjdGVkSXRlbUludGVyZmFjZVxuICA+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBjaGlsZEluZGV4OiBudW1iZXIgPSAwO1xuICBhbW91bnQ6IG51bWJlciA9IDA7XG4gIHN0YXJ0UHJlc3M6IG51bWJlciA9IDA7XG4gIGxhc3RYOiBudW1iZXIgPSAwO1xuXG4gIG9uTW91c2Vkb3duKGU6IE1vdXNlRXZlbnQpIHtcbiAgICBpZiAoZS53aGljaCA9PT0gMSkge1xuICAgICAgdGhpcy5zdGFydFByZXNzID0gZS5jbGllbnRYO1xuICAgICAgdGhpcy5sYXN0WCA9IHRoaXMuYW1vdW50O1xuICAgIH1cbiAgfVxuICBvblRvdWNoZG93bihlOiBUb3VjaEV2ZW50KSB7XG4gICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIkFuZHJvaWRcIikgPj0gMCkgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuc3RhcnRQcmVzcyA9IGUudGFyZ2V0VG91Y2hlc1swXS5jbGllbnRYO1xuICAgIHRoaXMubGFzdFggPSB0aGlzLmFtb3VudDtcbiAgfVxuXG4gIG9uTW91c2Vtb3ZlKGU6IE1vdXNlRXZlbnQsIG1heFdpZHRoOiBudW1iZXIpIHtcbiAgICBpZiAoZS53aGljaCA9PT0gMSkge1xuICAgICAgY29uc3QgYW1vdW50ID0gdGhpcy5sYXN0WCAtICh0aGlzLnN0YXJ0UHJlc3MgLSBlLmNsaWVudFgpO1xuICAgICAgaWYgKGFtb3VudCA+IDAgfHwgYW1vdW50IDwgLShtYXhXaWR0aCAtIHRoaXMud2lkdGgpKSByZXR1cm47XG4gICAgICB0aGlzLmFtb3VudCA9IGFtb3VudDtcbiAgICB9XG4gIH1cbiAgb25Ub3VjaG1vdmUoZTogVG91Y2hFdmVudCwgbWF4V2lkdGg6IG51bWJlcikge1xuICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJBbmRyb2lkXCIpID49IDApIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBhbW91bnQgPSB0aGlzLmxhc3RYIC0gKHRoaXMuc3RhcnRQcmVzcyAtIGUudGFyZ2V0VG91Y2hlc1swXS5jbGllbnRYKTtcbiAgICBpZiAoYW1vdW50ID4gMCB8fCBhbW91bnQgPCAtKG1heFdpZHRoIC0gdGhpcy53aWR0aCkpIHJldHVybjtcbiAgICB0aGlzLmFtb3VudCA9IGFtb3VudDtcbiAgfVxuXG4gIG9uTW91c2V1cChlOiBNb3VzZUV2ZW50LCBlbGVtOiBhbnkpIHtcbiAgICBpZiAoZS53aGljaCA9PT0gMSkge1xuICAgICAgdGhpcy5zdGFydFByZXNzID0gMDtcbiAgICAgIHRoaXMuc25hcChlbGVtKTtcbiAgICB9XG4gIH1cblxuICBvblRvdWNodXAoZTogVG91Y2hFdmVudCwgZWxlbTogYW55KSB7XG4gICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIkFuZHJvaWRcIikgPj0gMCkgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuc3RhcnRQcmVzcyA9IDA7XG4gICAgdGhpcy5zbmFwKGVsZW0pO1xuICB9XG5cbiAgc25hcChlbGVtOiBhbnkpIHtcbiAgICBsZXQgY291bnRlciA9IDA7XG4gICAgbGV0IGxhc3RWYWwgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZWwgPSBlbGVtLmNoaWxkcmVuW2ldO1xuICAgICAgY29uc3Qgc3R5bGUgPSBlbC5jdXJyZW50U3R5bGUgfHwgd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwpO1xuICAgICAgY291bnRlciArPVxuICAgICAgICBlbC5vZmZzZXRXaWR0aCArXG4gICAgICAgIChwYXJzZUZsb2F0KHN0eWxlLm1hcmdpbkxlZnQpICsgcGFyc2VGbG9hdChzdHlsZS5tYXJnaW5SaWdodCkpO1xuICAgICAgaWYgKHRoaXMuYW1vdW50IDw9IGxhc3RWYWwgJiYgdGhpcy5hbW91bnQgPj0gLWNvdW50ZXIpIHtcbiAgICAgICAgdGhpcy5hbW91bnQgPSAtbGFzdFZhbDtcbiAgICAgICAgdGhpcy5jaGlsZEluZGV4ID0gaTtcbiAgICAgICAgdGhpcy5vblNlbGVjdGVkSXRlbS5lbWl0KHtcbiAgICAgICAgICBpdGVtOiB0aGlzLml0ZW1zW3RoaXMuY2hpbGRJbmRleF0sXG4gICAgICAgICAgaW5kZXg6IHRoaXMuY2hpbGRJbmRleCxcbiAgICAgICAgICBmaXJzdDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGxhc3RWYWwgPSBjb3VudGVyO1xuICAgIH1cbiAgICByZXR1cm4gY291bnRlcjtcbiAgfVxuXG4gIHNjcm9sbChmb3J3YXJkOiBib29sZWFuLCBlbGVtOiBhbnkpIHtcbiAgICB0aGlzLmNoaWxkSW5kZXggKz0gZm9yd2FyZCA/IDEgOiAtMTtcbiAgICB0aGlzLm9uU2VsZWN0ZWRJdGVtLmVtaXQoe1xuICAgICAgaXRlbTogdGhpcy5pdGVtc1t0aGlzLmNoaWxkSW5kZXhdLFxuICAgICAgaW5kZXg6IHRoaXMuY2hpbGRJbmRleCxcbiAgICAgIGZpcnN0OiBmYWxzZVxuICAgIH0pO1xuICAgIHRoaXMuYW1vdW50ID0gLXRoaXMuY2FsY1Njcm9sbChlbGVtKTtcbiAgfVxuXG4gIGNhbGNTY3JvbGwoZWxlbTogYW55KSB7XG4gICAgbGV0IGNvdW50ZXIgPSAwO1xuICAgIGZvciAobGV0IGkgPSB0aGlzLmNoaWxkSW5kZXggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgZWwgPSBlbGVtLmNoaWxkcmVuW2ldO1xuICAgICAgY29uc3Qgc3R5bGUgPSBlbC5jdXJyZW50U3R5bGUgfHwgd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwpO1xuICAgICAgY291bnRlciArPVxuICAgICAgICBlbC5vZmZzZXRXaWR0aCArXG4gICAgICAgIChwYXJzZUZsb2F0KHN0eWxlLm1hcmdpbkxlZnQpICsgcGFyc2VGbG9hdChzdHlsZS5tYXJnaW5SaWdodCkpO1xuICAgIH1cbiAgICByZXR1cm4gY291bnRlcjtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAoXG4gICAgICBjaGFuZ2VzLml0ZW1zICYmXG4gICAgICAhaXNFcXVhbChjaGFuZ2VzLml0ZW1zLnByZXZpb3VzVmFsdWUsIGNoYW5nZXMuaXRlbXMuY3VycmVudFZhbHVlKVxuICAgICkge1xuICAgICAgaWYgKGNoYW5nZXMuaXRlbXMuZmlyc3RDaGFuZ2UpIHtcbiAgICAgICAgdGhpcy5vblNlbGVjdGVkSXRlbS5lbWl0KHtcbiAgICAgICAgICBpdGVtOiB0aGlzLml0ZW1zW3RoaXMuY2hpbGRJbmRleF0sXG4gICAgICAgICAgaW5kZXg6IHRoaXMuY2hpbGRJbmRleCxcbiAgICAgICAgICBmaXJzdDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuYW1vdW50ID0gMDtcbiAgICB9XG4gIH1cbn1cbiJdfQ==